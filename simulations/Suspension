#ARCHITECTURE OVERVIEW:
#1. DONE: Import two data files: Rover info and soil info
#   -100% complete:
#       *DONE:implement soil ini file
#2. Compute traction information from solid case
#   -0% complete:
#       *compute maximum thrust function
#       *compute compaction resistance function
#       *compute bulldozing resistance function
#       *compute rolling resistance (use coeff of 0 if negligable) function
#       *compute gravitational resistance function
#       *create aggregate drawbar pull function
#3. Create angle geometry calculator for pivot and 4 bar cases
#   -0% complete:
#       *differentiate from obstacle mode and slope mode
#       *from rover geometry and height, get alpha and beta
#4. Create matrix calculator
#   -1% comlete:
#       *function to generate computation matrix for each scenario:
#           1. rover climbing obstacle of height h lower than radius
#           2. rover climbing obstacle of height h higher than radius
#           3. rover going across a slope
#           4. rover driving straight
#5. create simulation
#   -0% complete:
#       *Calculate drawbar pull for each case mentioned previously
#       *calculate max velocity, acceleration and gradeability
#       *calculate required torque for stall conditions (adhesion based)
#       *calculate stability
#6. create simulation to optimize rover parameters
#   -0% complete:
#       *given rover parameter and acceptable ranges, run through all instances and find ideal case for each performance parameters
#7. optimize four bar rover
#   -0% complete:
#   -Based on previous ideal parameters, using all variable 4 bar variables, find ideal case for each performance parameters

from scipy.optimize import fsolve
import math
import numpy as np
import configparser

class rover:
    def __init__(self, roverconfiguration, four_bar = False):
        self.wheel_mass = float(roverconfiguration['Weight Values (in kg)']['wheel_mass'])
        self.wheel_mass = float(roverconfiguration['Weight Values (in kg)']['bogie_mass'])
        self.wheel_mass = float(roverconfiguration['Weight Values (in kg)']['body_mass'])
        self.coefficient_of_friction = float(roverconfiguration['Weight Values (in kg)']['coefficient_of_friction'])
        self.bogie_length = float(roverconfiguration['Lengths (in m)']['bogie_length'])
        self.wheel_link_length = float(roverconfiguration['Lengths (in m)']['wheel_link_length'])
        self.wheel_radius = float(roverconfiguration['Lengths (in m)']['wheel_radius'])
        self.wheel_width = float(roverconfiguration['Lengths (in m)']['wheel_width'])
        self.cg_length = float(roverconfiguration['Lengths (in m)']['cg_length'])
        self.cg_height = float(roverconfiguration['Lengths (in m)']['cg_height'])
        self.four_bar = four_bar
        self.slope_matrix = np.empty((15,15))
        self.low_obs_matrix = np.empty((15,15))
        self.high_obs_matrix = np.empty((15,15))

def compute_wheel_thrust(c, phi, Aw, W, slope_angle, J_K = 3):
    return (c*Aw + W*math.cos(slope_angle*math.pi/180.0)*math.tan(phi*math.pi/180.0))*(1.0-math.exp(-J_K))

rovconfig = configparser.ConfigParser()
rovconfig.sections()
rovconfig.read('Roverdata.ini')
soilconfig = configparser.ConfigParser()
soilconfig.sections()
soilconfig.read('Soil.ini')
#print('Weight Values (in kg)' in rovconfig)
#print(rovconfig['Weight Values (in kg)']['g'])
#print(rovconfig['Lengths (in m)']['cg_length'])
#print(soilconfig['Bekker parameters']['n'])
rover1 = rover(rovconfig)
